<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>gulp 笔记 | peigenzi的博客</title>
    <meta name="description" content="记录生活，记录成长">
    
    
    <link rel="preload" href="/assets/css/styles.1c4a54ce.css" as="style"><link rel="preload" href="/assets/js/app.1c4a54ce.js" as="script"><link rel="preload" href="/assets/js/30.e551cc72.js" as="script"><link rel="prefetch" href="/assets/css/1.styles.01cb36e5.css"><link rel="prefetch" href="/assets/css/2.styles.a2bd3099.css"><link rel="prefetch" href="/assets/js/1.01cb36e5.js"><link rel="prefetch" href="/assets/js/10.2fdd50d6.js"><link rel="prefetch" href="/assets/js/11.2d2c6fcc.js"><link rel="prefetch" href="/assets/js/12.9b3bf04b.js"><link rel="prefetch" href="/assets/js/13.436fbf63.js"><link rel="prefetch" href="/assets/js/14.eb8be8b1.js"><link rel="prefetch" href="/assets/js/15.ebfec248.js"><link rel="prefetch" href="/assets/js/16.356ece8e.js"><link rel="prefetch" href="/assets/js/17.3e5fa8ec.js"><link rel="prefetch" href="/assets/js/18.dc9e61fc.js"><link rel="prefetch" href="/assets/js/19.60702a65.js"><link rel="prefetch" href="/assets/js/2.a2bd3099.js"><link rel="prefetch" href="/assets/js/20.b18e4382.js"><link rel="prefetch" href="/assets/js/21.55008fa7.js"><link rel="prefetch" href="/assets/js/22.be265170.js"><link rel="prefetch" href="/assets/js/23.201fc306.js"><link rel="prefetch" href="/assets/js/24.5eaf0ab9.js"><link rel="prefetch" href="/assets/js/25.49fc652b.js"><link rel="prefetch" href="/assets/js/26.551d4d25.js"><link rel="prefetch" href="/assets/js/27.4604f4ac.js"><link rel="prefetch" href="/assets/js/28.300931aa.js"><link rel="prefetch" href="/assets/js/29.de40784f.js"><link rel="prefetch" href="/assets/js/3.c7b6448e.js"><link rel="prefetch" href="/assets/js/31.f80c50a6.js"><link rel="prefetch" href="/assets/js/32.65256d1b.js"><link rel="prefetch" href="/assets/js/4.3c531246.js"><link rel="prefetch" href="/assets/js/5.65222990.js"><link rel="prefetch" href="/assets/js/6.1945d516.js"><link rel="prefetch" href="/assets/js/7.e968e927.js"><link rel="prefetch" href="/assets/js/8.982350be.js"><link rel="prefetch" href="/assets/js/9.a2b73be3.js">
    <link rel="stylesheet" href="/assets/css/1.styles.01cb36e5.css"><link rel="stylesheet" href="/assets/css/2.styles.a2bd3099.css"><link rel="stylesheet" href="/assets/css/styles.1c4a54ce.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">peigenzi的博客</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">Home</a></div><div class="nav-item"><a href="https://www.google.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  External
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="/about.html" class="nav-link">关于</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">Home</a></div><div class="nav-item"><a href="https://www.google.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  External
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="/about.html" class="nav-link">关于</a></div> <!----></nav>  <ul class="sidebar-links"><li><div class="sidebar-group first"><p class="sidebar-heading"><span>JavaScript</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/blog/js/defineProperty.html" class="sidebar-link">Object.defineProperty()</a></li><li><a href="/blog/js/监控长任务.html" class="sidebar-link">监测长任务</a></li><li><a href="/blog/js/note-nunjucks.html" class="sidebar-link">nunjucks 笔记</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>CSS</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/blog/css/css技巧.html" class="sidebar-link">css 技巧</a></li><li><a href="/blog/css/重置样式.html" class="sidebar-link">重置样式</a></li><li><a href="/blog/css/bem总结.html" class="sidebar-link">bem 总结</a></li><li><a href="/blog/css/css3动画.html" class="sidebar-link">css3 动画</a></li><li><a href="/blog/css/scss快速上手.html" class="sidebar-link">Scss 快速上手</a></li><li><a href="/blog/css/scss常用函数.html" class="sidebar-link">Scss 常用函数</a></li><li><a href="/blog/css/栅格系统.html" class="sidebar-link">栅格系统</a></li><li><a href="/blog/css/table总结.html" class="sidebar-link">table 总结</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>Vue</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/blog/vue/Vue书写风格.html" class="sidebar-link">Vue 书写风格</a></li><li><a href="/blog/vue/Vue动画效果.html" class="sidebar-link">Vue 动画效果</a></li><li><a href="/blog/vue/可从外部关闭下拉菜单的Vue指令.html" class="sidebar-link">可从外部关闭下拉菜单的 Vue 指令</a></li><li><a href="/blog/vue/事件派发与广播.html" class="sidebar-link">事件派发与广播</a></li><li><a href="/blog/vue/找到任意组件实例的方法.html" class="sidebar-link">找到任意组件实例的方法</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>React</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/blog/react/React动画效果.html" class="sidebar-link">React 动画效果</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>小程序</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/blog/小程序/小程序登录鉴权.html" class="sidebar-link">小程序登录鉴权</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading open"><span>工程化</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/blog/工程化/gulp笔记.html" class="active sidebar-link">gulp 笔记</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/工程化/gulp笔记.html#gulp-src" class="sidebar-link">gulp.src()</a></li><li class="sidebar-sub-header"><a href="/blog/工程化/gulp笔记.html#gulp-desc" class="sidebar-link">gulp.desc()</a></li><li class="sidebar-sub-header"><a href="/blog/工程化/gulp笔记.html#gulp-task" class="sidebar-link">gulp.task()</a></li><li class="sidebar-sub-header"><a href="/blog/工程化/gulp笔记.html#gulp-watch" class="sidebar-link">gulp.watch()</a></li></ul></li><li><a href="/blog/工程化/babel笔记.html" class="sidebar-link">babel 笔记</a></li><li><a href="/blog/工程化/babel-polyfill笔记.html" class="sidebar-link">babel-polyfill 笔记</a></li><li><a href="/blog/工程化/babel-preset-env常用配置.html" class="sidebar-link">babel-preset-env 常用配置</a></li><li><a href="/blog/工程化/webpack4常用配置.html" class="sidebar-link">webpack4 常用配置</a></li><li><a href="/blog/工程化/webpack4笔记.html" class="sidebar-link">webpack4 笔记</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>性能</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/blog/performance/1使用 RAIL 模型评估性能.html" class="sidebar-link">使用 RAIL 模型评估性能</a></li></ul></div></li></ul> </div> <div class="page"> <div class="content"><h1 id="gulp-笔记"><a href="#gulp-笔记" aria-hidden="true" class="header-anchor">#</a> gulp 笔记</h1> <p>在 gulp 中，使用的是 Nodejs 中的 stream(流)，首先获取到需要的 stream，然后可以通过 stream 的 pipe() 方法把流导入到你想要的地方</p> <p>使用 gulp 只需要知道 4 个 API。
<code>gulp.task()</code>, <code>gulp.src()</code>, <code>gulp.desc()</code>, <code>gulp.watch()</code>。</p> <h2 id="gulp-src"><a href="#gulp-src" aria-hidden="true" class="header-anchor">#</a> gulp.src()</h2> <p><code>gulp.src()</code> 方法正是用来获取流的，但要注意这个流里的内容不是原始的文件流，而是一个虚拟文件对象流(Vinyl files)，这个虚拟文件对象中存储着原始文件的路径、文件名、内容等信息。</p> <div class="language-js extra-class"><pre class="language-js"><code>gulp<span class="token punctuation">.</span><span class="token function">src</span><span class="token punctuation">(</span>globs<span class="token punctuation">[</span><span class="token punctuation">,</span> options<span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token comment">//使用数组的方式来匹配多种文件</span>
gulp<span class="token punctuation">.</span><span class="token function">src</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'js/*.js'</span><span class="token punctuation">,</span><span class="token string">'css/*.css'</span><span class="token punctuation">,</span><span class="token string">'*.html'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

gulp<span class="token punctuation">.</span><span class="token function">src</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token operator">*</span><span class="token punctuation">.</span>js<span class="token punctuation">,</span><span class="token string">'!b*.js'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">//匹配所有js文件，但排除掉以b开头的js文件</span>
gulp<span class="token punctuation">.</span><span class="token function">src</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'!b*.js'</span><span class="token punctuation">,</span><span class="token operator">*</span><span class="token punctuation">.</span>js<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">/</span><span class="token operator">/</span>不会排除任何文件，因为排除模式不能出现在数组的第一个元素中
</code></pre></div><ul><li>globs 是文件的匹配模式(类似正则表达式)，当有多个匹配模式时，该参数可以为一个数组。</li> <li>options 为可选参数。通常情况下不需要用到。</li></ul> <h2 id="gulp-desc"><a href="#gulp-desc" aria-hidden="true" class="header-anchor">#</a> gulp.desc()</h2> <p><code>gulp.dest()</code> 方法是用来写文件的。
gulp 的使用流程一般是这样子的：首先通过 gulp.src() 方法获取到我们想要处理的文件流，然后把文件流通过 pipe 方法导入到 gulp 的插件中，最后把经过插件处理后的流再通过 pipe 方法导入到 gulp.dest() 中，gulp.dest() 方法则把流中的内容写入到文件中。</p> <div class="language-js extra-class"><pre class="language-js"><code>gulp<span class="token punctuation">.</span><span class="token function">dest</span><span class="token punctuation">(</span>path<span class="token punctuation">[</span><span class="token punctuation">,</span>options<span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre></div><ul><li>path 为要写入的文件</li> <li>options 为可选参数</li></ul> <p><code>gulp.desc()</code> 传入的路径参数，只能用来指定要生成的文件的<strong>目录</strong>，而不能指定生成文件的文件名，它生成文件的文件名使用的是导入到它的文件流自身的文件名，所以生成的文件名是由导入到它的文件流决定的，即使我们给它传入一个带有文件名的路径参数，然后它也会把这个文件名当做是目录名。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> gulp <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'gulp'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
gulp<span class="token punctuation">.</span><span class="token function">src</span><span class="token punctuation">(</span><span class="token string">'script/jquery.js'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>gulp<span class="token punctuation">.</span><span class="token function">dest</span><span class="token punctuation">(</span><span class="token string">'dist/foo.js'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//最终生成的文件路径为 dist/foo.js/jquery.js,而不是dist/foo.js</span>
</code></pre></div><p>gulp.dest(path) 生成的文件路径是我们传入的 path 参数后面再加上 gulp.src() 中有通配符开始出现的那部分路径。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> gulp <span class="token operator">=</span> <span class="token function">reruire</span><span class="token punctuation">(</span><span class="token string">'gulp'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//有通配符开始出现的那部分路径为 **/*.js</span>
gulp<span class="token punctuation">.</span><span class="token function">src</span><span class="token punctuation">(</span><span class="token string">'script/**/*.js'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>gulp<span class="token punctuation">.</span><span class="token function">dest</span><span class="token punctuation">(</span><span class="token string">'dist'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//最后生成的文件路径为 dist/**/*.js</span>
<span class="token comment">//如果 **/*.js 匹配到的文件为 jquery/jquery.js ,则生成的文件路径为 dist/jquery/jquery.js</span>

gulp
  <span class="token punctuation">.</span><span class="token function">src</span><span class="token punctuation">(</span><span class="token string">'script/avalon/avalon.js'</span><span class="token punctuation">)</span> <span class="token comment">//没有通配符出现的情况</span>
  <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>gulp<span class="token punctuation">.</span><span class="token function">dest</span><span class="token punctuation">(</span><span class="token string">'dist'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//最后生成的文件路径为 dist/avalon.js</span>

<span class="token comment">//有通配符开始出现的那部分路径为 **/underscore.js</span>
gulp
  <span class="token punctuation">.</span><span class="token function">src</span><span class="token punctuation">(</span><span class="token string">'script/**/underscore.js'</span><span class="token punctuation">)</span>
  <span class="token comment">//假设匹配到的文件为script/util/underscore.js</span>
  <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>gulp<span class="token punctuation">.</span><span class="token function">dest</span><span class="token punctuation">(</span><span class="token string">'dist'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//则最后生成的文件路径为 dist/util/underscore.js</span>

gulp
  <span class="token punctuation">.</span><span class="token function">src</span><span class="token punctuation">(</span><span class="token string">'script/*'</span><span class="token punctuation">)</span> <span class="token comment">//有通配符出现的那部分路径为 *</span>
  <span class="token operator">/</span><span class="token operator">/</span>假设匹配到的文件为script<span class="token operator">/</span>zepto<span class="token punctuation">.</span>js
  <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>gulp<span class="token punctuation">.</span><span class="token function">dest</span><span class="token punctuation">(</span><span class="token string">'dist'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token operator">/</span><span class="token operator">/</span>则最后生成的文件路径为 dist<span class="token operator">/</span>zepto<span class="token punctuation">.</span>js
</code></pre></div><p>通过指定 gulp.src() 方法配置参数中的 base 属性，我们可以更灵活的来改变 gulp.dest() 生成的文件路径。</p> <p>当我们没有在 gulp.src() 方法中配置 base 属性时，base 的默认值为通配符开始出现之前那部分路径。</p> <div class="language-js extra-class"><pre class="language-js"><code>gulp<span class="token punctuation">.</span><span class="token function">src</span><span class="token punctuation">(</span>script<span class="token operator">/</span>lib<span class="token comment">/*.js) //没有配置base参数，此时默认的base路径为script/lib
    //假设匹配到的文件为script/lib/jquery.js
    .pipe(gulp.dest('build')) //生成的文件路径为 build/jquery.js

gulp.src(script/lib/*.js, {base:'script'}) //配置了base参数，此时base路径为script
    //假设匹配到的文件为script/lib/jquery.js
    .pipe(gulp.dest('build')) //此时生成的文件路径为 build/lib/jquery.js
</span></code></pre></div><p>用 gulp.dest() 把文件流写入文件后，文件流仍然可以继续使用。</p> <h2 id="gulp-task"><a href="#gulp-task" aria-hidden="true" class="header-anchor">#</a> gulp.task()</h2> <p><code>gulp.task()</code> 方法用来定义任务。</p> <div class="language-js extra-class"><pre class="language-js"><code>gulp<span class="token punctuation">.</span><span class="token function">task</span><span class="token punctuation">(</span>name<span class="token punctuation">[</span><span class="token punctuation">,</span> deps<span class="token punctuation">]</span><span class="token punctuation">,</span> fn<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>name 为任务名</li> <li>deps 是当前定义的任务需要依赖的其他任务，为一个数组。当前定义的任务会在所有依赖的任务执行完毕后才开始执行。如果没有依赖，则可省略这个参数。</li> <li>fn 任务函数，我们把任务要执行的代码都写在里面。该参数也是可选的。</li></ul> <div class="language-js extra-class"><pre class="language-js"><code>gulp<span class="token punctuation">.</span><span class="token function">task</span><span class="token punctuation">(</span><span class="token string">'mytask'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'one'</span><span class="token punctuation">,</span> <span class="token string">'two'</span><span class="token punctuation">,</span> <span class="token string">'three'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">//定义一个有依赖的任务</span>
  <span class="token comment">// Do something</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>如果某个任务所依赖的任务是异步的，就要注意了，gulp 并不会等待那个所依赖的异步任务完成，而是会接着执行后续的任务。</p> <div class="language-js extra-class"><pre class="language-js"><code>gulp<span class="token punctuation">.</span><span class="token function">task</span><span class="token punctuation">(</span><span class="token string">'one'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">//one是一个异步执行的任务</span>
  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'one is done'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">5000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//two任务虽然依赖于one任务,但并不会等到one任务中的异步操作完成后再执行</span>
<span class="token comment">//two任务会在one任务中的异步操作完成之前就执行了。</span>
gulp<span class="token punctuation">.</span><span class="token function">task</span><span class="token punctuation">(</span><span class="token string">'two'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'one'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'two is done'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>如果想等待异步任务中的异步操作完成后再执行后续的任务。
有三种方法可以实现。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 第一：在异步操作完成后执行一个回调函数来通知gulp这个异步任务已经完成,这个回调函数就是任务函数的第一个参数。</span>
gulp<span class="token punctuation">.</span><span class="token function">task</span><span class="token punctuation">(</span><span class="token string">'one'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>cb<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">//cb为任务函数提供的回调，用来通知任务已经完成</span>
  <span class="token comment">//one是一个异步执行的任务</span>
  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'one is done'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">cb</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//执行回调，表示这个异步任务已经完成</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">5000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//这时two任务会在one任务中的异步操作完成后再执行</span>
gulp<span class="token punctuation">.</span><span class="token function">task</span><span class="token punctuation">(</span><span class="token string">'two'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'one'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'two is done'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 第二：定义任务时返回一个流对象。适用于任务就是操作gulp.src获取到的流的情况。</span>
gulp<span class="token punctuation">.</span><span class="token function">task</span><span class="token punctuation">(</span><span class="token string">'one'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>cb<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> stream <span class="token operator">=</span> gulp
    <span class="token punctuation">.</span><span class="token function">src</span><span class="token punctuation">(</span><span class="token string">'client/**/*.js'</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">dosomething</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">//dosomething()中有某些异步操作</span>
    <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>gulp<span class="token punctuation">.</span><span class="token function">dest</span><span class="token punctuation">(</span><span class="token string">'build'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> stream<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

gulp<span class="token punctuation">.</span><span class="token function">task</span><span class="token punctuation">(</span><span class="token string">'two'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'one'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'two is done'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 第三：返回一个promise对象，例如</span>
<span class="token keyword">var</span> <span class="token constant">Q</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'q'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//一个著名的异步处理的库 https://github.com/kriskowal/q</span>
gulp<span class="token punctuation">.</span><span class="token function">task</span><span class="token punctuation">(</span><span class="token string">'one'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>cb<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> deferred <span class="token operator">=</span> <span class="token constant">Q</span><span class="token punctuation">.</span><span class="token function">defer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 做一些异步操作</span>
  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    deferred<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">5000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> deferred<span class="token punctuation">.</span>promise<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

gulp<span class="token punctuation">.</span><span class="token function">task</span><span class="token punctuation">(</span><span class="token string">'two'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'one'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'two is done'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="gulp-watch"><a href="#gulp-watch" aria-hidden="true" class="header-anchor">#</a> gulp.watch()</h2> <p><code>gulp.watch()</code> 用来监听文件变化。</p> <div class="language-js extra-class"><pre class="language-js"><code>gulp<span class="token punctuation">.</span><span class="token function">watch</span><span class="token punctuation">(</span>glob<span class="token punctuation">[</span><span class="token punctuation">,</span> opts<span class="token punctuation">]</span><span class="token punctuation">,</span> tasks<span class="token punctuation">)</span>
</code></pre></div><ul><li>glob 为要监视的文件的匹配模式</li> <li>opts 为一个可选的配置对象</li> <li>tasks 为文件变化后要执行的任务，为一个数组</li></ul> <div class="language-js extra-class"><pre class="language-js"><code>gulp<span class="token punctuation">.</span><span class="token function">task</span><span class="token punctuation">(</span><span class="token string">'uglify'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">//do something</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
gulp<span class="token punctuation">.</span><span class="token function">task</span><span class="token punctuation">(</span><span class="token string">'reload'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">//do something</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
gulp<span class="token punctuation">.</span><span class="token function">watch</span><span class="token punctuation">(</span><span class="token string">'js/**/*.js'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'uglify'</span><span class="token punctuation">,</span> <span class="token string">'reload'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>另一种形式</p> <div class="language-js extra-class"><pre class="language-js"><code>gulp<span class="token punctuation">.</span><span class="token function">watch</span><span class="token punctuation">(</span>glob<span class="token punctuation">[</span><span class="token punctuation">,</span> opts<span class="token punctuation">,</span> cb<span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre></div><ul><li>cb 参数为一个函数。每当监视的文件发生变化时，就会调用这个函数,并且会给它传入一个对象，该对象包含了文件变化的一些信息，type 属性为变化的类型，可以是 added, changed, deleted；path 属性为发生变化的文件的路径。</li></ul> <div class="language-js extra-class"><pre class="language-js"><code>gulp<span class="token punctuation">.</span><span class="token function">watch</span><span class="token punctuation">(</span><span class="token string">'js/**/*.js'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>type<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//变化类型 added为新增,deleted为删除，changed为改变</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>path<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//变化的文件的路径</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>一个任务中可以多次运行 <code>gulp.watch</code> 监控不同的文件。</p> <div class="language-js extra-class"><pre class="language-js"><code>gulp<span class="token punctuation">.</span><span class="token function">task</span><span class="token punctuation">(</span><span class="token string">'auto'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  gulp<span class="token punctuation">.</span><span class="token function">wtach</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'src/*.css'</span><span class="token punctuation">,</span> <span class="token string">'example/*.css'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'css'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  gulp<span class="token punctuation">.</span><span class="token function">wtach</span><span class="token punctuation">(</span><span class="token string">'src/*.js'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'js'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></div> <div class="page-edit"><!----> <!----></div> <!----> </div> <!----></div></div>
    <script src="/assets/js/30.e551cc72.js" defer></script><script src="/assets/js/app.1c4a54ce.js" defer></script>
  </body>
</html>
