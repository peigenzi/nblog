<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>babel 笔记 | peigenzi的博客</title>
    <meta name="description" content="记录生活，记录成长">
    
    
    <link rel="preload" href="/assets/css/styles.613d531f.css" as="style"><link rel="preload" href="/assets/js/app.613d531f.js" as="script"><link rel="preload" href="/assets/js/27.d4bfbf60.js" as="script"><link rel="prefetch" href="/assets/css/1.styles.87b9e6fa.css"><link rel="prefetch" href="/assets/css/2.styles.a2bd3099.css"><link rel="prefetch" href="/assets/js/1.87b9e6fa.js"><link rel="prefetch" href="/assets/js/10.486bc3b5.js"><link rel="prefetch" href="/assets/js/11.2740aa39.js"><link rel="prefetch" href="/assets/js/12.dca4ad6e.js"><link rel="prefetch" href="/assets/js/13.e7f2eb25.js"><link rel="prefetch" href="/assets/js/14.9e7415ec.js"><link rel="prefetch" href="/assets/js/15.9a281c71.js"><link rel="prefetch" href="/assets/js/16.f9c3e05f.js"><link rel="prefetch" href="/assets/js/17.da4dd2f4.js"><link rel="prefetch" href="/assets/js/18.3ce14e87.js"><link rel="prefetch" href="/assets/js/19.9144fca1.js"><link rel="prefetch" href="/assets/js/2.a2bd3099.js"><link rel="prefetch" href="/assets/js/20.55456b64.js"><link rel="prefetch" href="/assets/js/21.eb87ce20.js"><link rel="prefetch" href="/assets/js/22.3032c894.js"><link rel="prefetch" href="/assets/js/23.68b362b8.js"><link rel="prefetch" href="/assets/js/24.05b6ca8d.js"><link rel="prefetch" href="/assets/js/25.72e5e4e2.js"><link rel="prefetch" href="/assets/js/26.210b553c.js"><link rel="prefetch" href="/assets/js/28.57bbe2af.js"><link rel="prefetch" href="/assets/js/29.e9bbb282.js"><link rel="prefetch" href="/assets/js/3.b179e001.js"><link rel="prefetch" href="/assets/js/30.22a571af.js"><link rel="prefetch" href="/assets/js/4.d90fa5e4.js"><link rel="prefetch" href="/assets/js/5.f96d621f.js"><link rel="prefetch" href="/assets/js/6.9779bc79.js"><link rel="prefetch" href="/assets/js/7.5c077e33.js"><link rel="prefetch" href="/assets/js/8.de0087fe.js"><link rel="prefetch" href="/assets/js/9.3714ce75.js">
    <link rel="stylesheet" href="/assets/css/1.styles.87b9e6fa.css"><link rel="stylesheet" href="/assets/css/2.styles.a2bd3099.css"><link rel="stylesheet" href="/assets/css/styles.613d531f.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">peigenzi的博客</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">Home</a></div><div class="nav-item"><a href="https://www.google.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  External
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="/about.html" class="nav-link">关于</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">Home</a></div><div class="nav-item"><a href="https://www.google.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  External
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="/about.html" class="nav-link">关于</a></div> <!----></nav>  <ul class="sidebar-links"><li><div class="sidebar-group first"><p class="sidebar-heading"><span>JavaScript</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/blog/js/defineProperty.html" class="sidebar-link">Object.defineProperty()</a></li><li><a href="/blog/js/监控长任务.html" class="sidebar-link">监测长任务</a></li><li><a href="/blog/js/note-nunjucks.html" class="sidebar-link">nunjucks 笔记</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>CSS</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/blog/css/css技巧.html" class="sidebar-link">css 技巧</a></li><li><a href="/blog/css/重置样式.html" class="sidebar-link">重置样式</a></li><li><a href="/blog/css/bem总结.html" class="sidebar-link">bem 总结</a></li><li><a href="/blog/css/css3动画.html" class="sidebar-link">css3 动画</a></li><li><a href="/blog/css/scss快速上手.html" class="sidebar-link">Scss 快速上手</a></li><li><a href="/blog/css/scss常用函数.html" class="sidebar-link">Scss 常用函数</a></li><li><a href="/blog/css/栅格系统.html" class="sidebar-link">栅格系统</a></li><li><a href="/blog/css/table总结.html" class="sidebar-link">table 总结</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>Vue</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/blog/vue/Vue书写风格.html" class="sidebar-link">Vue 书写风格</a></li><li><a href="/blog/vue/可从外部关闭下拉菜单的Vue指令.html" class="sidebar-link">可从外部关闭下拉菜单的 Vue 指令</a></li><li><a href="/blog/vue/事件派发与广播.html" class="sidebar-link">事件派发与广播</a></li><li><a href="/blog/vue/找到任意组件实例的方法.html" class="sidebar-link">找到任意组件实例的方法</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>小程序</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/blog/小程序/小程序登录鉴权.html" class="sidebar-link">小程序登录鉴权</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading open"><span>工程化</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/blog/工程化/gulp笔记.html" class="sidebar-link">gulp 笔记</a></li><li><a href="/blog/工程化/babel笔记.html" class="active sidebar-link">babel 笔记</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/工程化/babel笔记.html#几种配置方式" class="sidebar-link">几种配置方式</a></li><li class="sidebar-sub-header"><a href="/blog/工程化/babel笔记.html#配置项" class="sidebar-link">配置项</a></li><li class="sidebar-sub-header"><a href="/blog/工程化/babel笔记.html#babel-7-与-babel-6" class="sidebar-link">babel 7 与 babel 6</a></li><li class="sidebar-sub-header"><a href="/blog/工程化/babel笔记.html#配置升级" class="sidebar-link">配置升级</a></li></ul></li><li><a href="/blog/工程化/babel-polyfill笔记.html" class="sidebar-link">babel-polyfill 笔记</a></li><li><a href="/blog/工程化/babel-preset-env常用配置.html" class="sidebar-link">babel-preset-env 常用配置</a></li><li><a href="/blog/工程化/webpack4常用配置.html" class="sidebar-link">webpack4 常用配置</a></li><li><a href="/blog/工程化/webpack4笔记.html" class="sidebar-link">webpack4 笔记</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>性能</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/blog/performance/1使用 RAIL 模型评估性能.html" class="sidebar-link">使用 RAIL 模型评估性能</a></li></ul></div></li></ul> </div> <div class="page"> <div class="content"><h1 id="babel-笔记"><a href="#babel-笔记" aria-hidden="true" class="header-anchor">#</a> babel 笔记</h1> <h2 id="几种配置方式"><a href="#几种配置方式" aria-hidden="true" class="header-anchor">#</a> 几种配置方式</h2> <h3 id="babel-config-js"><a href="#babel-config-js" aria-hidden="true" class="header-anchor">#</a> babel.config.js</h3> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> presets <span class="token operator">=</span> <span class="token punctuation">[</span> <span class="token operator">...</span> <span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> plugins <span class="token operator">=</span> <span class="token punctuation">[</span> <span class="token operator">...</span> <span class="token punctuation">]</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    presets<span class="token punctuation">,</span>
    plugins
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="babelrc"><a href="#babelrc" aria-hidden="true" class="header-anchor">#</a> .babelrc</h3> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;presets&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>...<span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">&quot;plugins&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>...<span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="package-json"><a href="#package-json" aria-hidden="true" class="header-anchor">#</a> package.json</h3> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;my-package&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;version&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1.0.0&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;babel&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;presets&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span> ... <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">&quot;plugins&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span> ... <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="babelrc-js"><a href="#babelrc-js" aria-hidden="true" class="header-anchor">#</a> .babelrc.js</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> presets <span class="token operator">=</span> <span class="token punctuation">[</span> <span class="token operator">...</span> <span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> plugins <span class="token operator">=</span> <span class="token punctuation">[</span> <span class="token operator">...</span> <span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">[</span><span class="token string">&quot;ENV&quot;</span><span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token string">&quot;prod&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  plugins<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token operator">...</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span> presets<span class="token punctuation">,</span> plugins <span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="配置项"><a href="#配置项" aria-hidden="true" class="header-anchor">#</a> 配置项</h2> <ul><li>plugin: babel 的插件，在 6.x 版本之后 babel 必需要配合插件来进行工作</li> <li>preset: babel 插件集合的预设，包含某一部分的插件 plugin</li></ul> <h3 id="运行顺序"><a href="#运行顺序" aria-hidden="true" class="header-anchor">#</a> 运行顺序</h3> <ul><li>Plugin 会运行在 Preset 之前</li> <li>Plugin 会从第一个开始顺序执行</li> <li>Preset 的顺序则刚好相反(从最后一个逆序执行)</li></ul> <h2 id="babel-7-与-babel-6"><a href="#babel-7-与-babel-6" aria-hidden="true" class="header-anchor">#</a> babel 7 与 babel 6</h2> <p>babel 7 移除了 <code>stage-x</code> 插件。stage-x 插件原本是对应于 ECMA Script 提案中的不同阶段，每个阶段有不同特性。</p> <p>经常看到的 babel-preset-stage-0，其实就是这样的：</p> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  presets<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'babel-preset-stage-1'</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  plugins<span class="token punctuation">:</span> <span class="token punctuation">[</span>
    <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'babel-plugin-transform-do-expressions'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'babel-plugin-transform-function-bind'</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>每个 stage 插件都会包含下一阶段的所有插件，这就导致大家为了能用上大多数特性，纷纷采用了 babel-preset-stage-0，React 项目中，经常看到的 babelrc 配置是这样的：</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;presets&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;es2015&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;react&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;stage-0&quot;</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><p>然而，提案一直在变，如今是 stage 0 的特性，可能之后就进入到了 stage 1，也可能之后直接被否决抛弃掉，并不会进入到 ES 规范中。那么 babel 是不是应该更新这些 stage 插件呢？如果更新了，现阶段大量前端项目会不会突然发现就编译不了某个特性了呢？</p> <p>所以 babel 7 中废弃了 stage-x。需要开发者自己加上需要的插件，每个插件对应一个提案中的特性，这样项目中的配置也能更清晰。</p> <h2 id="配置升级"><a href="#配置升级" aria-hidden="true" class="header-anchor">#</a> 配置升级</h2> <p>项目中 babel 配置升级的方案就是把之前的 <code>es2015</code> 换成 <code>env</code>，<code>stage-x</code> 换成各种 <code>proposal-xxx</code>。
例如一个 React 项目：</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;presets&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">[</span>
      <span class="token string">&quot;@babel/preset-env&quot;</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">&quot;modules&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string">&quot;@babel/preset-react&quot;</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">&quot;plugins&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;@babel/proposal-class-properties&quot;</span><span class="token punctuation">]</span> //箭头函数被当作成class的属性来看待
  //插件在原来是包含在stage-<span class="token number">3</span>里面的，现在，就需要单独引入。
<span class="token punctuation">}</span>
</code></pre></div></div> <div class="page-edit"><!----> <!----></div> <!----> </div> <!----></div></div>
    <script src="/assets/js/27.d4bfbf60.js" defer></script><script src="/assets/js/app.613d531f.js" defer></script>
  </body>
</html>
