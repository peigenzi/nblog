(window.webpackJsonp=window.webpackJsonp||[]).push([[26],{169:function(t,s,n){"use strict";n.r(s);var a=n(0),e=Object(a.a)({},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("div",{staticClass:"content"},[t._m(0),t._v(" "),n("p",[n("a",{attrs:{href:"https://developers.weixin.qq.com/miniprogram/dev/framework/open-ability/image/api-login.jpg",target:"_blank",rel:"noopener noreferrer"}},[t._v("登录流程时序"),n("OutboundLink")],1)]),t._v(" "),n("p",[t._v("登录鉴权时，与小程序进行通信交互的不止是小程序前端和自己的服务端，微信第三方服务端也参与其中。")]),t._v(" "),t._m(1),t._v(" "),t._m(2),t._v(" "),t._m(3),t._m(4),t._v(" "),t._m(5),t._v(" "),t._m(6),t._v(" "),t._m(7),t._v(" "),t._m(8),t._v(" "),t._m(9),t._v(" "),t._m(10),t._m(11),t._v(" "),t._m(12),t._v(" "),t._m(13),t._v(" "),t._m(14),t._m(15),t._v(" "),t._m(16),t._v(" "),t._m(17),t._v(" "),t._m(18),t._v(" "),t._m(19)])},[function(){var t=this.$createElement,s=this._self._c||t;return s("h1",{attrs:{id:"小程序登录鉴权"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#小程序登录鉴权","aria-hidden":"true"}},[this._v("#")]),this._v(" 小程序登录鉴权")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"_1-调用-wx-login-生成-code"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-调用-wx-login-生成-code","aria-hidden":"true"}},[this._v("#")]),this._v(" 1.调用 wx.login 生成 code")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("code",[this._v("wx.login()")]),this._v(" 这个 API 的作用就是为当前用户生成一个"),s("strong",[this._v("临时的登录凭证")]),this._v("，这个临时登录凭证的有效期只有五分钟。我们拿到这个登录凭证后就可以进行下一步操作：获取 "),s("code",[this._v("openid")]),this._v(" 和 "),s("code",[this._v("session_key")])])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[t._v("wx"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("login")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  success"),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" res "),n("span",{attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("res"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("code"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),n("span",{attrs:{class:"token comment"}},[t._v("// ...")]),t._v("\n    "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"_2-获取-openid-和-session-key"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-获取-openid-和-session-key","aria-hidden":"true"}},[this._v("#")]),this._v(" 2.获取 openid 和 session_key")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("在微信公众平台里，"),s("code",[this._v("openid")]),this._v(" 用来标识每个用户在订阅号、服务号、小程序这三种不同应用的唯一标识，也就是说每个用户在每个应用的 "),s("code",[this._v("openid")]),this._v(" 都是不一致的，所以在小程序里，我们可以用 "),s("code",[this._v("openid")]),this._v(" 来标识用户的唯一性。")])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("p",[n("code",[t._v("session_key")]),t._v(" 用于保证当前用户进行会话操作的有效性，这个 "),n("code",[t._v("session_key")]),t._v(" 是微信服务端给我们派发的。也就是说，我们可以用这个标识来间接地维护我们小程序用户的登录态，那么这个 "),n("code",[t._v("session_key")]),t._v(" 是怎么拿到的呢？我们需要在自己的服务端请求微信提供的第三方接口"),n("code",[t._v("https://api.weixin.qq.com/sns/jscode2session")]),t._v("。这个接口需要带上四个参数字段。")])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("table",[n("thead",[n("tr",[n("th",{staticStyle:{"text-align":"left"}},[t._v("参数")]),t._v(" "),n("th",{staticStyle:{"text-align":"left"}},[t._v("值")])])]),t._v(" "),n("tbody",[n("tr",[n("td",{staticStyle:{"text-align":"left"}},[t._v("appid")]),t._v(" "),n("td",{staticStyle:{"text-align":"left"}},[t._v("小程序 appid")])]),t._v(" "),n("tr",[n("td",{staticStyle:{"text-align":"left"}},[t._v("secret")]),t._v(" "),n("td",{staticStyle:{"text-align":"left"}},[t._v("小程序 secret")])]),t._v(" "),n("tr",[n("td",{staticStyle:{"text-align":"left"}},[t._v("js_code")]),t._v(" "),n("td",{staticStyle:{"text-align":"left"}},[t._v("wx.login 获取的 code")])]),t._v(" "),n("tr",[n("td",{staticStyle:{"text-align":"left"}},[t._v("grant_type")]),t._v(" "),n("td",{staticStyle:{"text-align":"left"}},[t._v("'authorization_code'")])])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("出于安全性的考量，要在服务端来请求这个接口。避免将我们小程序的 "),s("code",[this._v("appid")]),this._v(" 和小程序的 "),s("code",[this._v("secret")]),this._v(" 暴露在外部，同时也避免暴露微信服务端下发的 "),s("code",[this._v("session_key")]),this._v("。")])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("ul",[n("li",[n("code",[t._v("session_key")]),t._v(" 和微信派发的 "),n("code",[t._v("code")]),t._v(" 是一一对应的，同一 "),n("code",[t._v("code")]),t._v(" 只能换取一次 "),n("code",[t._v("session_key")]),t._v("。每次调用"),n("code",[t._v("wx.login()")]),t._v("，都会下发一个新的 "),n("code",[t._v("code")]),t._v(" 和对应的"),n("code",[t._v("session_key")]),t._v("，为了保证用户体验和登录态的有效性，应该在用户需要重新登录时才去调用 "),n("code",[t._v("wx.login()")]),t._v("。")]),t._v(" "),n("li",[n("code",[t._v("session_key")]),t._v(" 是有时效性的，即便是不调用"),n("code",[t._v("wx.login")]),t._v("，"),n("code",[t._v("session_key")]),t._v(" 也会过期，过期时间跟用户使用小程序的频率成正相关，但具体的时间长短开发者和用户都是获取不到的。")])])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{attrs:{class:"token function"}},[t._v("getSessionKey")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("code"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" appid"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" appSecret"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),n("span",{attrs:{class:"token keyword"}},[t._v("let")]),t._v(" opt "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    method"),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{attrs:{class:"token string"}},[t._v("'GET'")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    url"),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{attrs:{class:"token string"}},[t._v("'https://api.weixin.qq.com/sns/jscode2session'")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    params"),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      appid"),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" appid"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      secret"),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" appSecret"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      js_code"),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" code"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      grant_type"),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{attrs:{class:"token string"}},[t._v("'authorization_code'")]),t._v("\n    "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  "),n("span",{attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),n("span",{attrs:{class:"token function"}},[t._v("http")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("opt"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("then")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token keyword"}},[t._v("function")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("response"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{attrs:{class:"token keyword"}},[t._v("var")]),t._v(" data "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" response"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("data"),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token operator"}},[t._v("!")]),t._v("data"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("openid "),n("span",{attrs:{class:"token operator"}},[t._v("||")]),t._v(" "),n("span",{attrs:{class:"token operator"}},[t._v("!")]),t._v("data"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("session_key "),n("span",{attrs:{class:"token operator"}},[t._v("||")]),t._v(" data"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("errcode"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),n("span",{attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        result"),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{attrs:{class:"token operator"}},[t._v("-")]),n("span",{attrs:{class:"token number"}},[t._v("2")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        errmsg"),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" data"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("errmsg "),n("span",{attrs:{class:"token operator"}},[t._v("||")]),t._v(" "),n("span",{attrs:{class:"token string"}},[t._v("'返回数据字段不完整'")]),t._v("\n      "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),n("span",{attrs:{class:"token keyword"}},[t._v("return")]),t._v(" data"),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"_3-生成-skey"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-生成-skey","aria-hidden":"true"}},[this._v("#")]),this._v(" 3.生成 skey")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("如果直接使用微信服务端派发的 "),s("code",[this._v("session_key")]),this._v(" 来作为业务方的登录态使用，会被“有心之人”用来获取用户的敏感信息。我们需要自己维护用户的登录态信息。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("可以使用几种常见的不可逆的哈希算法，比如 "),s("code",[this._v("md5")]),this._v("、"),s("code",[this._v("sha1")]),this._v(" 等，将生成后的登录态标识（这里统称为'skey'）返回给前端，并在前端维护这份登录态标识(一般是存入"),s("code",[this._v("storage")]),this._v(")。而在服务端呢，我们会把生成的 skey 存在用户对应的数据表中，前端通过传递 skey 来存取用户的信息。")])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{attrs:{class:"token keyword"}},[t._v("const")]),t._v(" crypto "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{attrs:{class:"token function"}},[t._v("require")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token string"}},[t._v("'crypto'")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),n("span",{attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),n("span",{attrs:{class:"token function"}},[t._v("getSessionKey")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("code"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" appid"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" secret"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("then")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("resData "),n("span",{attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),n("span",{attrs:{class:"token comment"}},[t._v("// 选择加密算法生成自己的登录态标识")]),t._v("\n  "),n("span",{attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" session_key "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" resData"),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),n("span",{attrs:{class:"token keyword"}},[t._v("const")]),t._v(" skey "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{attrs:{class:"token function"}},[t._v("encryptSha1")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("session_key"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),n("span",{attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{attrs:{class:"token function"}},[t._v("encryptSha1")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("data"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),n("span",{attrs:{class:"token keyword"}},[t._v("return")]),t._v(" crypto\n    "),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("createHash")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token string"}},[t._v("'sha1'")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("update")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("data"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{attrs:{class:"token string"}},[t._v("'utf8'")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("digest")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token string"}},[t._v("'hex'")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"checksession"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#checksession","aria-hidden":"true"}},[this._v("#")]),this._v(" checkSession")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("前面我们将 skey 存入前端的 "),s("code",[this._v("storage")]),this._v(" 里，每次进行用户数据请求时会带上 skey。所以需要检查 "),s("code",[this._v("session_key")]),this._v(" 是否过期。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("可以通过 "),s("code",[this._v("wx.checkSession")]),this._v(" 校验。 这个 API 并不需要传入任何有关 "),s("code",[this._v("session_key")]),this._v(" 的信息参数，而是微信小程序自己去调自己的服务来查询用户最近一次生成的"),s("code",[this._v("session_key")]),this._v(" 是否过期。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("code",[this._v("checkSession")]),this._v(" 这个步骤呢，我们一般是放在小程序启动时就校验登录态的逻辑处。")])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{attrs:{class:"token keyword"}},[t._v("let")]),t._v(" loginFlag "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" wx"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("getStorageSync")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token string"}},[t._v("'skey'")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),n("span",{attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("loginFlag"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),n("span",{attrs:{class:"token comment"}},[t._v("// 检查 session_key 是否过期")]),t._v("\n  wx"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("checkSession")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{attrs:{class:"token comment"}},[t._v("// session_key 有效(未过期)")]),t._v("\n    success"),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),n("span",{attrs:{class:"token comment"}},[t._v("// 业务逻辑处理")]),t._v("\n    "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\n    "),n("span",{attrs:{class:"token comment"}},[t._v("// session_key 过期")]),t._v("\n    fail"),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("function")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),n("span",{attrs:{class:"token comment"}},[t._v("// session_key过期，重新登录")]),t._v("\n      "),n("span",{attrs:{class:"token function"}},[t._v("doLogin")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),n("span",{attrs:{class:"token comment"}},[t._v("// 无skey，作为首次登录")]),t._v("\n  "),n("span",{attrs:{class:"token function"}},[t._v("doLogin")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])}],!1,null,null,null);e.options.__file="小程序登录鉴权.md";s.default=e.exports}}]);